  <!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>Withdrawal | Koozai Digital Agency Marketing</title>
      <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
      />
      <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        rel="stylesheet"
      />
      <link href="./assets/css/style.css" rel="stylesheet" />
      <link href="./assets/css/buttons.css" rel="stylesheet" />
      <link href="./assets/css/responsive.css" rel="stylesheet" />
    </head>
    <div id="loadingSpinner" class="loader-container d-none">
      <span class="loader"></span>
  </div>"
    <body class="bg-light-theme">
      <div class="body-wrapper">
        <header class="shadow-sm position-relative">
          <a href="./index.html">
            <img
              src="./assets/images/chevron-back-outline.svg"
              class="pointer"
              width="30px"
            />
          </a>
          <div class="page-title">Withdrawal</div>
        </header>
        <div class="body-content withdraw-page">
          <ul class="nav nav-tabs withdraw-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="withdraw-now-tab"
                data-bs-toggle="tab"
                data-bs-target="#withdraw-now"
                type="button"
                role="tab"
                aria-controls="withdraw-now"
                aria-selected="true"
              >
                Withdraw Now
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="withdraw-history-tab"
                data-bs-toggle="tab"
                data-bs-target="#withdraw-history"
                type="button"
                role="tab"
                aria-controls="withdraw-history"
                aria-selected="false"
              >
                Withdraw History
              </button>
            </li>
          </ul>
          <div class="tab-content" id="myTabContent">
            <div
              class="tab-pane fade show active"
              id="withdraw-now"
              role="tabpanel"
              aria-labelledby="home-tab"
            >
              <div class="withdraw-now">
                <div class="row">
                  <div class="col-md-12 col-xl-6 col-lg-7">
                    <div class="total-balance">
                      <label>Total Balance</label>
                      <div class="balance">USDT15688.93</div>
                      <div class="info mt-3">
                        withdrawal processing time is 15-20 minutes
                      </div>
                    </div>
                    <div class="withdraw-form mt-4">
                      <p class="mb-1">
                        - Withdrawal will be credited to your binding USDT TRC20
                        address within 30 minutes.
                      </p>
                      <p class="mb-1">
                        - Kindly confirm your address with customer service after
                        you submit the withdrawal request.
                      </p>
                      <div class="box mt-3">
                        <div class="auth-control-row border-top-0">
                          <span>Withdraw Amount</span>
                          <input type="text" placeholder="Type Here" id="withdrawAmountInput" />
                        </div>
                        <div
                          class="auth-control-row border-top-0 border-bottom-0"
                        >
                          <span>Withdrawal Password</span>
                          <input type="password" placeholder="Type Here" id="withdrawPasswordInput" />
                        </div>
                      </div>
                      <div class="mt-3">
                        <button
                        id="withdrawSubmitButton"
                          class="btn btn-theme btn-lg w-100 rounded-4 shadow"
                        >
                          <b>Submit</b>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="tab-pane fade show active"
              id="withdraw-history"
              role="tabpanel"
              aria-labelledby="home-tab"
            >
              <div class="withdraw-history">
                <div class="py-4 text-center">
                  <small class="text-black-50"
                    >withdrawal processing time is 15-20 minutes</small
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>




       <!-- Deposit Modal -->
<div class="modal fade" id="depositModal" tabindex="-1" role="dialog" aria-labelledby="depositModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document" style="max-width: 400px;"> <!-- Adjust the max-width as needed -->
    <div class="modal-content bg-white shadow">
      <div class="modal-body">
        <ul id="whatsappLinks" class="list-unstyled text-center">
          <!-- Your WhatsApp links here -->
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary close" data-dismiss="modal" aria-label="Close" id="closeModalButton">Close</button>
      </div>
    </div>
  </div>
</div>

       <!-- Add your deposit amount boxes and form here -->
    </div>


    <!-- modal.html -->
    <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true" >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-white w-auto mx-auto">
          <div class="modal-body show_message bg-dark text-center">
            <p id="messageContent" class="text-center mt-3"></p>
          </div>
        </div>
      </div>
    </div>
      <!-- CDN -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

      <script>




        // Function to parse JWT token
  function parseJwt(token) {
    const base64Url = token.split('.')[1];
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
      atob(base64)
        .split('')
        .map(function (c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        })
        .join('')
    );

    return JSON.parse(jsonPayload);
  }


  // Function to show the loading spinner
  function showLoadingSpinner() {
      $('#loadingSpinner').removeClass('d-none');
  }

  // Function to hide the loading spinner
  function hideLoadingSpinner() {
      $('#loadingSpinner').addClass('d-none');
  }

  function showMessageModal(message, isError) {
      const modal = $('#messageModal');
      const modalContent = modal.find('.modal-content');
      const messageContent = $('#messageContent');

      // Set the message and style based on whether it's an error or success
      messageContent.text(message);
      if (isError) {
          modalContent.removeClass('bg-success').addClass('bg-danger');
      } else {
          modalContent.removeClass('bg-danger').addClass('bg-success');
      }

      modal.modal('show');
      setTimeout(function () {
          modal.modal('hide');
      }, 5000); // Hide the modal after 2 seconds
  }

  // ##############  WITHDRAWAL API CALL #################
  $('#withdrawSubmitButton').on('click', function () {
    const token = localStorage.getItem('user_token');
    const decodedToken = parseJwt(token);
    const userId = decodedToken.userId;

    const withdrawAmount = parseFloat($('#withdrawAmountInput').val()) || 0; // Replace with the appropriate input field ID
    const withdrawPassword = $('#withdrawPasswordInput').val(); // Replace with the appropriate input field ID

    // Validate withdrawal amount (must be a positive number)
    if (isNaN(withdrawAmount) || withdrawAmount <= 0) {
      showMessageModal('Please enter a valid withdrawal amount.', true);
      return;
    }

    // Show loading spinner while the withdrawal request is in progress
    showLoadingSpinner();

    // Create the withdrawal request data
    const withdrawalData = {
      userId: userId,
      amount: withdrawAmount,
      withdrawPassword: withdrawPassword,
    };

    // Make an AJAX POST request to the withdrawal API endpoint
    $.ajax({
      type: 'POST',
      url: 'http://localhost:5000/api/withdraw_amount',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`,
      },
      data: JSON.stringify(withdrawalData),
      success: function (response) {
        // Handle the success response here
        const supportWhatsAppData = response.supportWhatsAppData;

        // Update the modal with WhatsApp links, names, and statuses
        const whatsappLinksList = $('#whatsappLinks');
        whatsappLinksList.empty();

        supportWhatsAppData.forEach(contact => {
          if (contact.status === 'active') {
            whatsappLinksList.append(`<li><a href="${contact.whatsappLink}" target="_blank">${contact.name}</a></li>`);
          } else {
            whatsappLinksList.append(`<li>${contact.name} (Closed)</li>`);
          }
        });

        // Open the modal
        $('#withdrawalModal').modal('show');
      },
      error: function (error) {
        console.log(error)
        // Handle the error response here
        showMessageModal(error.responseJSON.error, true);
      },
      complete: function () {
        // Hide loading spinner when the API request is complete
        hideLoadingSpinner();
      }
    });
  });

      </script>
    </body>
  </html>
